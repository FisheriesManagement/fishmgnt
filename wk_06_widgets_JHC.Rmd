---
title: "Prices through time"
author: "Juliana Herrera, Alexandra Smith"
date: "February 12, 2016"
output: html_document
---
Ex-vessel prices through time from 1993 until 2013. Mean values for snapper in Costa Rica.
```{r, echo=FALSE, include =FALSE}
#==PART 1===========================================================
# loading packages
library(readr)
library(readxl)
library(ggplot2)
library(plyr)
library(dplyr)
library(tidyr)
library(dygraphs)

#==PART 2===========================================================
# Loading data from excel and correction for inflation based on the Consumer Price Index (CPI)
#===================================================================

data <- read_excel('./data/prices.xlsx') 
colnames(data) <- tolower(colnames(data))
CPI <- read_excel('./data/CPI2.xlsx') # Consumer Price Index - source: World Bank
# CPIm <- read_excel('CPI.xlsx') # Consumer Price Index by month : World Bank
catch <- read_excel('./data/For CRSeafood code/catches.xlsx') %>%
  gather('month','catch',Jan:Dec) %>%
  select(-catch, -month) %>% 
  filter(Region != 'Mar Caribe', Species == c('Pargo', 'Pargo Seda')) %>% 
  group_by(Region, Year) %>% 
  summarise(sum=sum(Total)) # total catch of pargo and pargo seda per region and year
colnames(catch) <- tolower(colnames(catch))
  
yrprices <- (data) %>%
  select(-fishery, -spp) %>%
  group_by(year) %>% 
  summarize(meanprice = mean(price, na.rm=T)) %>% 
  left_join(CPI, by = 'year') %>%
  mutate(corrected = meanprice/cpi*cpi[24])
head(yrprices) # corrected prices for inflation. Baseline year = 2013

# p <-ggplot(yrprices) + ## Graph of corrected prices per year
#   geom_line(aes(x=year, y=meanprice, colour = 'meanprice')) +
#   geom_line(aes(x=year, y=corrected, colour ='corrected')) +
#   theme_bw()
# p


```

```{r, echo=F}
## Using dygraphs
Tprices <-  yrprices %>% 
  select(-meanprice, -cpi) %>% 
  left_join(catch, by = "year") %>% 
  spread(region, sum)
colnames(Tprices) <- toupper(colnames(Tprices))

dygraph(Tprices) %>% 
   dyRangeSelector() %>% 
  dySeries("CORRECTED", axis="y2") %>% 
 dyAxis("y", label = "Total catch (kg)") %>% 
  dyAxis("y2", label = "Mean price (colones/kg)") %>% 
  dyOptions(fillGraph = TRUE, fillAlpha = 0.4)

```



## Regional Catch Data MotionChart (1990-2013)

```{r googlevis library, results='asis', warning=F, include=F}
suppressPackageStartupMessages({
  library(googleVis)  # install.packages('googleVis')
})


# must set this option for googleVis charts to show up
op <- options(gvis.plot.tag='chart')

```


```{r motion data only, include=F}

motioncatch=read_csv('./data/For CRSeafood code/motioncatch.csv') %>%
  distinct() %>%
  group_by(Region,Year) %>%
  summarise(
    
    Annual_Catch=sum(Catch)
  )

```

```{r MotionChartCatch Data, results='asis', tidy=FALSE, echo=F}


C= gvisMotionChart(motioncatch, idvar='Region', timevar = 'Year', colorvar = ' options=list(width=600,    height=500), sizevar = 'Annual_Catch')

plot(C)

```
