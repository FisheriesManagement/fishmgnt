---
title: "wk06_widgets_CF"
author: "Caio Faro"
date: "February 13, 2016"
output: html_document
---


```{r warning=FALSE, message=FALSE}

require(ggplot2)
require(leaflet)
require(readr)
require(tidyr)
require(dplyr)

regions = read_csv(
'region,lat,lng
Golfito,8.623588,-83.162973
Quepos,9.414501,-84.175904
Golfo de Nicoya,9.965930,-84.889331
Guanacaste,10.667990,-85.751037')

# show regions as markers
leaflet(regions) %>%
  addTiles() %>%
  addMarkers(~lng,~lat)


#problems(read_csv('./data/For CRSeafood code/catches.csv'))
catches =  read_csv('./data/For CRSeafood code/catches.csv') %>%
  gather("Month", "Catch", 4:16) %>%
  filter(Species == c("Pargo", "Pargo Seda") & Month == "Total" & Region != "Mar Caribe") %>%
  group_by(Region, Year) %>%
  summarise(catch = sum(Catch)) %>%
  select(region=Region, year=Year, catch) %>%
  mutate(
    radius = catch / max(catch) * 10)


rc = regions %>%
  left_join(catches, by='region')

# for a single year of catch
leaflet(
  rc %>%
    filter(year==1992)) %>%
  addTiles() %>%
  addCircles(lng=~lng, lat=~lat, radius=~catch)

# now with multiple years of catch
leaflet() %>%
  addTiles() %>%
  addCircles(lng=~lng, lat=~lat, radius=~radius, data=filter(rc, year==1992), group='1992') %>%
  addCircles(lng=~lng, lat=~lat, radius=~radius, data=filter(rc, year==1993), group='1993') %>%
  addLayersControl(
    overlayGroups = c('1992','1993'),
    options = layersControlOptions(collapsed = FALSE)) %>%
  hideGroup('1993')
```


```{r manipulate, eval=FALSE}
library(manipulate)

yrs = setNames(unique(rc$year), unique(rc$year))

manipulate({
  
  # filter to year
  d = filter(rc, year==yr)
  
  # plot map
  leaflet() %>%
    addTiles() %>%
    addCircles(lng=~lng, lat=~lat, radius=~catch, data=d)
}, yr = picker(c(1992,1993)))
```

